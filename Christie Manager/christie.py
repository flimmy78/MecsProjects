# -*- coding: utf-8 -*-

from socket import *
import subprocess
import sys

popens = [None, None, None, None]

HOST = ''  # Symbolic name meaning all available interfaces
PORT = 4352 # Arbitrary non-privileged port
s = socket(AF_INET, SOCK_STREAM)
s.bind((HOST, PORT))
s.listen(5)
message = '''(LST+TILS!
Index              IP     Serial  A-X,Y   FMT FEB Rt Gt Bt  Rd  Gd  Bd F0 F1  E
*   0  128.35.230.227 0x0023e6e3  0- 1, 1  31  45 35 57 44 204 252 148 22 24  0
*   1   128.36.203.67 0x0024cb43  0- 5, 0  30  43 34 57 45 229 252 171 26 24  0
*   2  128.36.203.160 0x0024cba0  0- 3, 0  31  45 35 57 47 188 252 138 23 24  0
*   3   128.36.213.35 0x0024d523  0- 0, 1  30  43 35 58 44 245 252 159 23 26  0
*   4  128.36.215.252 0x0024d7fc  0- 3, 3  29  43 34 55 44 208 252 153 23 25  0
*   5  128.36.218.208 0x0024dad0  0- 1, 0  31  44 37 58 45 184 252 154 27 23  0
*   6   128.36.220.76 0x0024dc4c  0- 2, 1  32  44 38 57 45 242 252 160 26 23  0
*   7  128.36.223.220 0x0024dfdc  0- 4, 3  29  42 35 55 44 221 252 189 25 22  0
*   8  128.36.224.146 0x0024e092  0- 2, 0  31  44 36 60 46 201 252 154 26 24  0
*   9   128.39.75.124 0x00274b7c  0- 0, 0  30  44 35 51 40 214 165 135 22 20  0
*  10   128.53.47.170 0x00352faa  0- 5, 2  29  40 40 48 38 199 144 116 24 25  0
*  11   128.53.56.164 0x003538a4  0- 5, 3  29  40 36 44 54 170 131 110 25 24  0
*  12   128.53.61.154 0x00353d9a  0- 2, 2  30  42 35 46 39 183 124  89 24 24  0
*  13  128.55.162.173 0x0037a2ad  0- 4, 1  31  41 35 47 38 172 135  97 25 24  0
*  14   128.55.217.24 0x0037d918  0- 0, 2  29  40 34 44 38 200 148 109 24 24  0
*  15  128.55.217.113 0x0037d971  0- 4, 0  30  42 37 53 41 191 163 126 26 24  0
*  16  128.55.221.142 0x0037dd8e  0- 4, 2  30  41 39 46 38 202 134  94 23 24  0
*  17   128.56.59.103 0x00383b67  0- 1, 3  29  40 35 44 39 170 135 100 23 25  0
*  18   128.56.67.201 0x003843c9  0- 3, 1  31  42 37 46 39 166 112  82 25 23  0
*  19   128.56.70.217 0x003846d9  0- 3, 2  30  42 39 49 39 225 160 119 26 23  0
*  20   128.56.70.229 0x003846e5  0- 1, 2  34  42 34 45 38 171 142 110 24 22  0
*  21    128.57.72.34 0x00394822  0- 5, 1  29  40 33 45 35 178 130  89 23 24  0
*  22    128.57.72.71 0x00394847  0- 0, 3  29  40 33 42 36 151 113  91 25 22  0
*  23   128.58.170.51 0x003aaa33  0- 2, 3  30  40 34 37 35 200  70  85 23 25  0
)'''
while 1:
    conn, addr = s.accept()
    print('Connected by', addr) # Debug

    while 1:
        data = conn.recv(1024)
        if not data: break
	if '(LST+TILS?)' in data:
		conn.send(message)		
        conn.send(data) # Echo
#	print('Data size:', len(data))
        print('Data pack:', data) # Debug
#        str = data.decode()
        #--volume <integer> sets the level of audio output (between 0 and 1024)       
    conn.close()


